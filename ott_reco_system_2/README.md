# OTT 추천 시스템 파이프라인

## 개요

이 시스템은 사용자의 선호도, 시청 가능 시간, 예산 등을 고려하여 최적의 OTT 서비스와 콘텐츠를 추천해주는 개인화된 추천 시스템이다. 자연어 처리와 유사도 분석을 통해 사용자 선호 장르와 콘텐츠 간의 의미적 관계를 파악한다.

## 주요 구성 요소

### 1. 데이터 로드 (`load_data`)

-   **입력 데이터**:
    -   `train_data.csv`: 콘텐츠 메타데이터 (제목, 장르, 세부장르, 연령대, 성별, 평점, 러닝타임, 에피소드 수 등)
    -   `ott_price.csv`: OTT 서비스 가격 정보 (서비스명, 요금제, 월 구독료)
-   **출력**: 정제된 콘텐츠 및 가격 데이터프레임

### 2. 언어 모델 (`load_language_model`)

-   **모델**: SentenceTransformer의 다국어 지원 모델 (`paraphrase-multilingual-MiniLM-L12-v2`)
-   **목적**: 한국어 장르명을 포함한 텍스트 의미 임베딩 생성
-   **특징**: 다국어 지원으로 한국어 장르명에도 작동

### 3. 사용자 입력 수집 (`get_user_input`)

-   **입력 항목**:
    -   **장르**: 기본 장르 (영화, 드라마, 예능 등) - 콤마로 다중 선택 가능
    -   **세부 장르**: 세부 테마 장르 (SF, 스릴러, 코미디 등) - 콤마로 다중 선택 가능
    -   **인구통계**: 연령대, 성별
    -   **시청 패턴**: 주간 평균 시청 시간 (시간 단위)
    -   **예산 제한**: 월 구독 서비스에 지출 가능한 최대 금액 (원 단위)
-   **특징**: 장르 데이터에서 중복을 제거하여 사용자에게 정돈된 옵션 제공

### 4. 장르 임베딩 및 유사도 계산

-   **장르 임베딩 생성** (`add_genre_embeddings`):
    -   콘텐츠 데이터의 장르 정보를 정리
    -   세부 장르를 리스트로 변환
-   **유사도 계산** (`calculate_genre_similarity`):
    -   사용자 선호 장르와 콘텐츠 장르 간 의미적 유사도 계산
    -   코사인 유사도를 활용한 벡터 유사성 측정
    -   최대 유사도 접근법: 각 사용자 장르별 최대 유사도의 평균 값 활용

### 5. 러닝타임 추정 (`estimate_runtime_hours`)

-   **분 단위 변환**: 러닝타임(분)을 시간 단위로 환산
-   **에피소드 처리**: 드라마/시리즈의 에피소드 수를 1화당 1시간으로 가정
-   **기본값**: 정보 부재 시 기본 1시간으로 설정

> **확장 또는 수정이 필요한 부분**: 러닝 타임이 없을 경우 처리 방안을 모색할 필요가 있음.

### 6. 추천 알고리즘 (`recommend`)

#### 필터링 프로세스

-   **초기 필터**: 기본 장르, 연령대, 성별 모두 적용
-   **단계적 필터 완화**:
    1. 추천 수가 최소 기준(3개) 미달 시 연령대·성별 필터를 적용하여 완화된 조건에서 필터링
    2. 여전히 부족 시 기본 장르 필터만 적용
    3. 그래도 없을 시 필터 없이 전체 콘텐츠 대상

> ~~**확장 또는 수정이 필요한 부분**: 현재 추천 알고리즘은 필터링을 완화할 때마다 기존 후보군을 버리고 새로운 후보군으로 대체하는 방식으로 구현되어 있음. 이를 기존 콘텐츠를 유지하면서 필터링 완화를 통해 추가로 콘텐츠를 찾는 방식으로 수정할 필요가 있음.~~ -> 수정 완료
> 필터 완화 과정에서 추천 품질과 다양성 간의 균형 유지 방안 마련이 필요해보임. 시즌만 다른 같은 콘텐츠를 여러개 추천하는 문제가 있음.

#### 점수 계산 및 콘텐츠 선택

-   **종합 점수 구성**:
    -   장르 유사도: 50% (사용자 선호 장르와의 의미적 일치도)
    -   평점: 30% (정규화된 콘텐츠 평점)
    -   시청 효율성: 20% (짧은 콘텐츠 선호 가중치)
-   **그리디 선택 방식**:
    -   월간 시청 가능 시간 내에서 종합 점수가 높은 콘텐츠 선택
    -   최소 3개, 최대 8개 콘텐츠 추천
    -   시간 제약으로 최소 기준 미달 시, 점수 상위 콘텐츠 고정 추천

> **확장 또는 수정이 필요한 부분**: 최적의 종합 점수 구성을 찾을 필요가 있음. 그리디 선택 방식말고, 다이나믹이나 다른 방법도 모색할 필요가 있음.

#### OTT 서비스 선택

-   **플랫폼 파싱**: 추천 콘텐츠에서 필요한 OTT 서비스 추출
-   **최적 요금제 선택**: 각 플랫폼의 최저가 요금제 선택
-   **예산 관리**: 총 구독 비용과 사용자 예산 비교

### 7. 결과 출력

-   **추천 구독 플랜**: OTT 서비스별 요금제, 가격, 총 구독 비용
-   **추천 콘텐츠**: 제목, 장르, 세부 장르, 예상 시청 시간, 평점, 장르 유사도
-   **사용자 정보**: 예산, 총 예상 시청 시간

> **확장 또는 수정이 필요한 부분**: 현재는 OTT 서비스별로 구독비를 계산하여 총합을 반환하기만 하고, 예산을 고려하여 콘텐츠를 추천하지 않았음. 콘텐츠는 일단 기존대로 추천하되 예산을 고려해서 시청 순서도 제안할 수 있도록 기능 확장이 필요함.

## 알고리즘 특징

-   **의미 기반 추천**: 단순 키워드 매칭이 아닌 의미적 유사도 기반 추천
-   **그리디 최적화**: 시청 시간과 예산 제약 하에서 효용 최대화
-   **필터 완화 전략**: 조건 미충족 시 단계적으로 필터 완화
-   **개인화**: 인구통계, 선호 장르, 시청 패턴을 고려한 맞춤형 추천

## 향후 개선 방향

-   **0-1 배낭 문제 적용**: 현재 그리디 방식에서 정확한 최적화 알고리즘 도입
-   **협업 필터링 통합**: 유사 사용자의 선호도 패턴 반영
-   **강화학습 모델**: 사용자 피드백을 통한 지속적 모델 개선
-   **예산 최적화**: 예산 내에서 콘텐츠 커버리지를 최대화하는 OTT 조합 추천

## 개선이 필요한 부분

러닝타임 추정 개선: 러닝 타임 정보가 없는 콘텐츠에 대한 더 정확한 추정 방법 개발 필요
종합 점수 최적화: 장르 유사도(50%), 평점(30%), 시청 효율성(20%)의 가중치 조정으로 최적의 추천 결과 도출 필요
콘텐츠 선택 알고리즘 개선: 현재 그리디 방식에서 다이나믹 프로그래밍이나 다른 최적화 알고리즘 적용 검토
예산 기반 추천 발전: OTT 서비스 구독비 총합 계산을 넘어, 예산을 고려한 콘텐츠 추천 및 시청 순서 제안 기능 추가
필터링 전략 최적화: 필터 완화 과정에서 추천 품질과 다양성 간의 균형 유지 방안 마련
